<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>羽球戰術討論板</title>
<style>
  :root{
    --bg:#0b1222; --panel:#0f1b33; --border:#23324d; --text:#e5e7eb;
    --court-grass-1:#165a4a; --court-grass-2:#1e6f5c;
    --net-band:#2a2945;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{display:grid;grid-template-rows:auto 1fr;background:var(--bg);color:var(--text);
       font-family:system-ui,"Noto Sans TC",sans-serif;overflow:hidden;}
  header{display:flex;gap:10px;align-items:center;flex-wrap:wrap;padding:8px 12px;
         border-bottom:1px solid var(--border);background:#0b152a;z-index:2;}
  header h1{margin:0 6px 0 0;font-size:15px}
  select,button{background:var(--panel);border:1px solid var(--border);color:var(--text);
    border-radius:10px;padding:6px 10px;font-size:14px;cursor:pointer}
  .legend{margin-left:auto;display:flex;align-items:center;gap:8px}
  .wrap{position:relative;min-height:0;display:flex;justify-content:center;align-items:center;padding:8px;}
  .board{background:#07101f;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.45), inset 0 0 0 1px var(--border);
    display:flex;align-items:center;justify-content:center;position:relative;transition:transform .35s ease;}
  svg{width:96%;height:96%;display:block;touch-action:none}
  .hint{position:absolute;left:10px;bottom:10px;font-size:12px;color:#aab8d6;opacity:.9;
        background:rgba(15,27,51,.6);padding:6px 8px;border:1px solid var(--border);border-radius:10px}
  .draggable{cursor:grab}
  .dragging{cursor:grabbing;filter:drop-shadow(0 6px 10px rgba(0,0,0,.5))}
</style>
</head>
<body>
<header id="topbar">
  <h1>羽球戰術討論板</h1>
  <label>模式：
    <select id="mode">
      <option value="singles">單打</option>
      <option value="doubles" selected>雙打</option>
    </select>
  </label>
  <button id="resetBtn">重置位置</button>
  <button id="rotateBtn">旋轉90°檢視</button>
  <div class="legend">A隊(red.png) / B隊(blue.png)</div>
</header>

<div class="wrap" id="wrap">
  <div class="board" id="board">
    <svg id="court" viewBox="0 0 6500 13800">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#165a4a"/><stop offset="100%" stop-color="#1e6f5c"/>
        </linearGradient>
        <pattern id="netgrid" width="140" height="140" patternUnits="userSpaceOnUse">
          <path d="M0 0H140M0 0V140" stroke="#e5e7eb" stroke-opacity=".55" stroke-width="10"/>
        </pattern>
      </defs>

      <!-- 場地 -->
      <rect x="200" y="200" width="6100" height="13400" rx="20" fill="url(#g)"/>
      <g stroke="#ffffff" stroke-width="60" fill="none">
        <rect x="200" y="200" width="6100" height="13400"/>
        <rect x="660" y="200" width="5180" height="13400"/>
        <line x1="200" y1="4920" x2="6300" y2="4920"/>
        <line x1="200" y1="8880" x2="6300" y2="8880"/>
        <line x1="200" y1="960"  x2="6300" y2="960"/>
        <line x1="200" y1="12840" x2="6300" y2="12840"/>
        <line x1="3250" y1="200"  x2="3250" y2="4920"/>
        <line x1="3250" y1="8880" x2="3250" y2="13600"/>
      </g>

      <!-- 網帶 -->
      <g id="net">
        <rect x="200" y="6770" width="6100" height="260" fill="#2a2945" opacity="0.9"/>
        <rect x="200" y="6770" width="6100" height="260" fill="url(#netgrid)" opacity="0.9"/>
        <rect x="200" y="6760" width="6100" height="40" fill="#fff"/>
      </g>

      <!-- A隊球員 red.png -->
      <g id="A1" class="draggable" data-role="A1" transform="translate(3250,10800)">
        <image x="-400" y="-400" width="800" height="800" preserveAspectRatio="xMidYMid meet"
               href="red.png" xlink:href="red.png"/>
      </g>
      <g id="A2" class="draggable" data-role="A2" transform="translate(3250,9000)">
        <image x="-400" y="-400" width="800" height="800" preserveAspectRatio="xMidYMid meet"
               href="red.png" xlink:href="red.png"/>
      </g>

      <!-- B隊球員 blue.png -->
      <g id="B1" class="draggable" data-role="B1" transform="translate(3250,4800)">
        <image x="-400" y="-400" width="800" height="800" preserveAspectRatio="xMidYMid meet"
               href="blue.png" xlink:href="blue.png"/>
      </g>
      <g id="B2" class="draggable" data-role="B2" transform="translate(3250,3200)">
        <image x="-400" y="-400" width="800" height="800" preserveAspectRatio="xMidYMid meet"
               href="blue.png" xlink:href="blue.png"/>
      </g>

      <!-- 羽球 shuttle.png -->
      <g id="SHUTTLE" class="draggable" data-role="S" transform="translate(3250,6500)">
        <image x="-450" y="-450" width="900" height="900"
               preserveAspectRatio="xMidYMid meet"
               href="shuttle.png" xlink:href="shuttle.png"/>
      </g>
    </svg>

    <div class="hint">拖曳球員／羽球。單打只顯示 A1/B1；「旋轉90°」可橫向觀看。</div>
  </div>
</div>

<script>
(function(){
  const board=document.getElementById('board');
  const modeSel=document.getElementById('mode');
  const resetBtn=document.getElementById('resetBtn');
  const rotateBtn=document.getElementById('rotateBtn');
  const svg=document.getElementById('court');

  // 拖曳範圍
  const BOUNDS={xMin:200,yMin:200,xMax:6300,yMax:13600};
  const RAD={piece:400,shuttle:450}; // 放大後半徑

  const defaults={
    singles:{A1:{x:3250,y:10800},B1:{x:3250,y:3000},S:{x:3250,y:6500}},
    doubles:{A1:{x:3250,y:10800},A2:{x:3250,y:9000},B1:{x:3250,y:4800},B2:{x:3250,y:3200},S:{x:3250,y:6500}}
  };
  let state={mode:'doubles',positions:clone(defaults.doubles),rotated:false};

  modeSel.value=state.mode;
  updateVisibilityByMode(state.mode);
  renderPositions();

  resetBtn.addEventListener('click',()=>{state.positions=clone(defaults[state.mode]);renderPositions(true);});
  rotateBtn.addEventListener('click',()=>{state.rotated=!state.rotated;board.style.transform=state.rotated?'rotate(90deg) scale(0.92)':'rotate(0deg) scale(1)';});
  modeSel.addEventListener('change',e=>{
    state.mode=e.target.value==='singles'?'singles':'doubles';
    state.positions=clone(defaults[state.mode]);
    updateVisibilityByMode(state.mode);renderPositions(true);
  });

  const draggables=svg.querySelectorAll('.draggable');
  draggables.forEach(makeDraggable);

  function makeDraggable(el){
    el.style.touchAction='none';
    el.addEventListener('pointerdown',e=>{
      e.preventDefault();el.setPointerCapture(e.pointerId);el.classList.add('dragging');
      const role=el.dataset.role;const start=getPt(e);
      const t=el.transform.baseVal.consolidate();const init=t?{x:t.matrix.e,y:t.matrix.f}:{x:0,y:0};
      const move=ev=>{const p=getPt(ev);const nx=init.x+(p.x-start.x);const ny=init.y+(p.y-start.y);const c=clamp(nx,ny,role);state.positions[role]=c;setPos(el,c.x,c.y);};
      const up=()=>{el.releasePointerCapture(e.pointerId);el.classList.remove('dragging');svg.removeEventListener('pointermove',move);};
      svg.addEventListener('pointermove',move);svg.addEventListener('pointerup',up,{once:true});svg.addEventListener('pointercancel',up,{once:true});
    });
  }
  function getPt(e){const pt=svg.createSVGPoint();pt.x=e.clientX;pt.y=e.clientY;return pt.matrixTransform(svg.getScreenCTM().inverse());}
  function clamp(x,y,role){const r=(role==='S')?RAD.shuttle:RAD.piece;return{x:Math.min(BOUNDS.xMax-r,Math.max(BOUNDS.xMin+r,x)),y:Math.min(BOUNDS.yMax-r,Math.max(BOUNDS.yMin+r,y))};}
  function setPos(el,x,y){el.setAttribute('transform',`translate(${x},${y})`);}
  function updateVisibilityByMode(mode){document.getElementById('A2').style.display=(mode==='doubles')?'':'none';document.getElementById('B2').style.display=(mode==='doubles')?'':'none';}
  function renderPositions(){['A1','A2','B1','B2','S'].forEach(id=>{const el=document.getElementById(id==='S'?'SHUTTLE':id);if(!el)return;if(state.mode==='singles'&&(id==='A2'||id==='B2')){el.style.display='none';return;}el.style.display='';const p=state.positions[id]||defaults[state.mode][id];setPos(el,p.x,p.y);});}
  function clone(o){return JSON.parse(JSON.stringify(o));}
})();
</script>
</body>
</html>
